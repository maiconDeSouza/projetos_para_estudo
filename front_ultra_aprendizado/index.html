<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mapa de Estudos — 90 dias</title>
<style>
  :root{
    --gap: 10px;
    --cell-radius: 10px;
    --cell-min-h: 88px;
    --bg: #f5f7fb;
    --card: #ffffff;
    --green: #e6fbef;
    --green-border: #2fa86f;
    --red: #fff0f0;
    --red-border: #e05a5a;
    --pending: #f3f6fa;
    --accent: #6b46c1;
    --muted: #6b7280;
    --shadow: 0 6px 18px rgba(13,18,30,0.06);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }

  html,body{height:100%;margin:0;background:linear-gradient(180deg,#fbfdff, #f5f7fb);color:#0f172a}
  .wrap{max-width:1200px;margin:28px auto;padding:18px}
  .header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px}
  .title {font-size:1.25rem;font-weight:700;display:flex;flex-direction:column}
  .meta {font-size:0.95rem;color:var(--muted);margin-top:6px}

  /* progress */
  .progress-wrap{display:flex;align-items:center;gap:12px}
  .progress {width:420px;background:var(--pending);height:14px;border-radius:999px;overflow:hidden;box-shadow:inset 0 -2px 6px rgba(0,0,0,0.03)}
  .progress > .bar{height:100%;width:0%;background:linear-gradient(90deg,#6b46c1,#2fa86f);transition:width .6s ease}
  .progress-label{font-size:0.9rem;color:var(--muted);min-width:120px;text-align:right}

  /* controls */
  .controls {display:flex;gap:8px;align-items:center}
  .btn {background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
  .btn.secondary{background:#fff;color:var(--accent);border:1px solid rgba(107,70,193,0.12)}
  .timer {font-weight:700;font-size:1rem;background:#fff;padding:8px 12px;border-radius:8px;box-shadow:var(--shadow)}

  /* board */
  .board { margin-top:18px; display:grid; grid-template-columns: repeat(10,1fr); gap:var(--gap); }
  .cell {
    background:var(--card);
    border-radius:var(--cell-radius);
    min-height:var(--cell-min-h);
    padding:10px;
    box-shadow:var(--shadow);
    display:flex;
    flex-direction:column;
    justify-content:space-between;
    transition: transform .12s ease, box-shadow .12s ease;
    position:relative;
    overflow:hidden;
    border:1px solid rgba(15,23,42,0.04);
  }
  .cell:hover { transform:translateY(-6px); box-shadow: 0 12px 30px rgba(13,18,30,0.08); }

  .cell .head {display:flex;justify-content:space-between;align-items:center}
  .day {font-weight:800;font-size:0.95rem}
  .date {font-size:0.82rem;color:var(--muted)}

  .minutes {font-size:0.85rem;color:var(--muted);margin-top:8px}
  .milestone {font-size:0.8rem;color:#0f172a;opacity:0.85;margin-top:8px}

  /* states */
  .cell.green { background: var(--green); border: 1px solid var(--green-border); }
  .cell.red { background: var(--red); border: 1px solid var(--red-border); }
  .cell.pending { background: var(--pending); border-style: dashed; border-color: rgba(15,23,42,0.04); }

  /* badge */
  .badge { position:absolute; top:8px; right:8px; font-size:11px; padding:4px 6px; border-radius:999px; background:rgba(255,255,255,0.8); color:var(--muted); box-shadow:0 2px 6px rgba(2,6,23,0.06); }

  /* tooltip (milestone) */
  .milestone-dot { display:inline-block;width:8px;height:8px;border-radius:50%;background:var(--accent);margin-right:6px;vertical-align:middle; }
  .cell .tip { display:block;font-size:0.78rem;color:#0f172a;opacity:0.9;margin-top:6px }

  /* legend + responsive */
  .legend { margin-top:12px; display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .legend .item {display:flex;align-items:center;gap:8px;font-size:0.9rem;color:var(--muted)}
  .swatch {width:18px;height:18px;border-radius:6px;box-shadow:0 2px 6px rgba(2,6,23,0.06);border:1px solid rgba(0,0,0,0.04)}
  .sw-green{background:var(--green);border:1px solid var(--green-border)}
  .sw-red{background:var(--red);border:1px solid var(--red-border)}
  .sw-pend{background:var(--pending);border:1px dashed rgba(15,23,42,0.04)}

  @media (max-width:1100px){
    .board{grid-template-columns: repeat(6,1fr)}
    .progress{width:260px}
  }
  @media (max-width:640px){
    .board{grid-template-columns: repeat(3,1fr)}
    .title{font-size:1rem}
    .progress{width:160px}
  }

  /* small sparkle animation when painting */
  .paint-anim { animation: paint .6s ease; }
  @keyframes paint {
    0%{ transform: scale(0.98); filter:brightness(0.95) }
    60%{ transform: scale(1.02); filter:brightness(1.06) }
    100%{ transform: scale(1); filter:none }
  }

</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <div>Mapa de estudos — 90 dias</div>
        <div class="meta">Meta: <strong>180 horas</strong> • Restam: <span id="remainingDisplay">180h 0m</span></div>
      </div>

      <div class="controls">
        <div class="progress-wrap">
          <div class="progress" aria-hidden="true"><div class="bar" id="progressBar"></div></div>
          <div class="progress-label" id="progressLabel">0h / 180h</div>
        </div>
        <div style="width:12px"></div>
        <div class="timer" id="timerDisplay">00:00</div>
        <button class="btn" id="startBtn">Iniciar</button>
        <button class="btn secondary" id="stopBtn" disabled>Parar</button>
      </div>
    </div>

    <div class="board" id="board"></div>

    <div class="legend">
      <div class="item"><div class="swatch sw-green"></div>Dia completo (≥ 2h)</div>
      <div class="item"><div class="swatch sw-red"></div>Dia incompleto</div>
      <div class="item"><div class="swatch sw-pend"></div>Futuro / não iniciado</div>
      <div style="flex:1"></div>
      <div class="item">Marcos importantes aparecem nos dias</div>
    </div>
  </div>

<script>
/*
  Gera 90 células automaticamente. Cada célula tem:
  - data-day (1..90)
  - data-date (ISO string) opcional
  - state: 'pending' | 'red' | 'green' (inicially pending/red based on date)
  - você vai atualizar estado quando salvar no backend (fetch) ou localStorage
*/

/* Configurações iniciais */
const TOTAL_DAYS = 90;
const START_DATE = new Date(); // troque para a data do projeto se quiser
const GOAL_MINUTES = 180 * 60; // em minutos * 60? aqui só para exibir; internamente gerencie em minutos

/* Exemplo de milestones (mapa) -- chave é dia number */
const MILESTONES = {
  9: "Fim do Meta-aprendizagem (mapa + 18 h)",
  16: "Entregar blog + site p/ captura de leads",
  30: "MVP comparador - primeira versão",
  60: "Integração de preços - abordagem inicial",
  90: "Entrega final - lançamento"
};

/* Estado local (mock). Em produção você vai buscar do backend: dayMinutes{day:minutes} e dayStatus{day:state} */
let dayMinutes = {}; // ex: {1: 130, 2: 0, ...}
let dayStatus = {};  // ex: {1: 'green', 2: 'red', 10: 'pending'}

/* Util - formata data para iso yyyy-mm-dd */
function isoDate(d){
  return d.toISOString().slice(0,10);
}

/* Inicializa board */
const board = document.getElementById('board');

for (let i=1;i<=TOTAL_DAYS;i++){
  // calcular date - 0 based
  const cellDate = new Date(START_DATE);
  cellDate.setDate(START_DATE.getDate() + (i-1));
  const iso = isoDate(cellDate);

  // default status: future => pending; past today => red (no minutes)
  const today = new Date();
  const status = cellDate > today ? 'pending' : 'red';

  dayMinutes[i] = 0;
  dayStatus[i] = status;

  const div = document.createElement('div');
  div.className = `cell ${status}`;
  div.setAttribute('data-day', i);
  div.setAttribute('data-date', iso);
  div.setAttribute('id', `cell-${i}`);
  div.innerHTML = `
    <div class="head">
      <div class="day">Dia ${i}</div>
      <div class="date">${iso}</div>
    </div>
    <div>
      <div class="minutes" id="minutes-${i}">0 min</div>
      ${ MILESTONES[i] ? `<div class="milestone"><span class="milestone-dot"></span><span class="tip">${MILESTONES[i]}</span></div>` : '' }
    </div>
    <div class="badge" id="badge-${i}">${status === 'green' ? '✓' : (status === 'red' ? '!' : '')}</div>
  `;
  board.appendChild(div);
}

/* Funções para atualizar estado do dia (chamar após salvar no backend) */
function paintDay(day, minutes) {
  const el = document.getElementById(`cell-${day}`);
  dayMinutes[day] = minutes;
  const minEl = document.getElementById(`minutes-${day}`);
  minEl.textContent = `${minutes} min`;

  const state = minutes >= 120 ? 'green' : (new Date(document.querySelector(`#cell-${day}`).dataset.date) > new Date() ? 'pending' : 'red');

  // reset classes
  el.classList.remove('green','red','pending');
  el.classList.add(state);
  el.classList.add('paint-anim');

  const badge = document.getElementById(`badge-${day}`);
  badge.textContent = state==='green' ? '✓' : (state==='red' ? '!' : '');
  // atualizar progress geral
  updateProgress();
  // remover anim class depois
  setTimeout(()=>el.classList.remove('paint-anim'),700);
}

/* Progress e remaining */
function totalStudiedMinutes(){
  return Object.values(dayMinutes).reduce((a,b)=>a+(Number(b)||0),0);
}
function updateProgress(){
  const totalMin = totalStudiedMinutes();
  const goalMin = 180 * 60; // se quiser em minutos: 10800 (180h * 60)
  // para barra vamos usar horas percent
  const percent = Math.min(100, Math.round((totalMin/60) / 180 * 100));
  document.getElementById('progressBar').style.width = percent + '%';
  const hours = Math.floor(totalMin/60);
  document.getElementById('progressLabel').textContent = `${hours}h / 180h`;
  const remMin = Math.max(0, 180*60/60 - hours); // simples
  document.getElementById('remainingDisplay').textContent = `${Math.max(0,180 - hours)}h ${Math.max(0,60 - (totalMin % 60))}m`;
}

/* Timer (simples, cliente) - demonstração; em produção você usa endpoints start/stop */
let timerInterval=null, elapsed=0, activeDay=null;
const startBtn = document.getElementById('startBtn'), stopBtn = document.getElementById('stopBtn'), timerDisplay = document.getElementById('timerDisplay');

startBtn.addEventListener('click', ()=>{
  // por simplicidade vamos contar para o dia atual (1..90) se estiver dentro do período
  const now = new Date();
  const dayIndex = Math.floor((now - START_DATE) / (1000*60*60*24)) + 1;
  if(dayIndex < 1 || dayIndex > TOTAL_DAYS){ alert('Fora do período de 90 dias'); return; }
  activeDay = dayIndex;
  startBtn.disabled=true; stopBtn.disabled=false;
  elapsed = 0;
  timerDisplay.textContent = '00:00';
  timerInterval = setInterval(()=>{ elapsed++; timerDisplay.textContent = formatTime(elapsed); },1000);
});

stopBtn.addEventListener('click', ()=>{
  if(!activeDay) return;
  clearInterval(timerInterval);
  // adicionar minutos ao dia (somar)
  const added = Math.round(elapsed/60);
  dayMinutes[activeDay] = (Number(dayMinutes[activeDay])||0) + added;
  paintDay(activeDay, dayMinutes[activeDay]);
  activeDay = null;
  startBtn.disabled=false; stopBtn.disabled=true;
  timerDisplay.textContent = '00:00';
  // OBS: aqui você chamaria seu endpoint para salvar sessão no backend
});

/* util */
function formatTime(s){ const m=Math.floor(s/60).toString().padStart(2,'0'); const sec=(s%60).toString().padStart(2,'0'); return `${m}:${sec}`; }

/* init progress */
updateProgress();
</script>
</body>
</html>
